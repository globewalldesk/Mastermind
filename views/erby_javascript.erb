<script>
  var colors = <%= @gamehash.colors %>;
  var pegCellColors = []; // Will be an array of the current peg cell colors.
  function nextColor(i) {
    // Remove all highlighting from guide pegs.
    removeAllHighlighting();
    // Get index number of this peg's current cell color.
    var colorNum = pegCellColors[i];
    // Get next color (in a word, not a number) after that.
    var nextColorWord = getNextColor(colorNum, i);
    // Set pegcell class to next color.
    var thisCell = document.getElementById("peg" + i);
    var hiddenInput = document.getElementById("pegSubmit" + i);
    var lastGuideCell = document.getElementById("guidecell-" + colors[(colorNum || 0)]);
    var guideCell = document.getElementById("guidecell-" + nextColorWord);
    if (nextColorWord != "hole") {
      thisCell.className = "peg center-block " + nextColorWord;
      hiddenInput.setAttribute("value", nextColorWord);
      lastGuideCell.classList.remove("guide-highlight");
      guideCell.classList.add("guide-highlight");
    } else {
      thisCell.className = "hole center-block";
      hiddenInput.setAttribute("value", "hole");
      document.getElementById("guidecell-" + colors.slice(-1) ).classList.remove("guide-highlight");
    }
  }

  // This not only returns the color word, it sets the next number.
  function getNextColor(colorNum, i) {
    if (colorNum == undefined) {
      pegCellColors[i] = 0;
      return colors[0];
    } else if (colorNum < (colors.length - 1)) {
      pegCellColors[i] = colorNum + 1;
      return colors[colorNum + 1];
    } else {
      pegCellColors[i] = undefined;
      return "hole";
    }
  }

  // This simply displays the #guide div, a popup that is used to help the user
  // choose a color.
  function showGuide() {
    var guide = document.getElementById("guide");
    guide.style.display = "inline-block";
  }

  // This hides the #guide div.
  function hideGuide() {
    var guide = document.getElementById("guide");
    guide.style.display = "none";
    // NEED TO DELETE ALL OLD HIGHLIGHTS ON MOUSEOFF
    removeAllHighlighting();
  }

  function removeAllHighlighting() {
    var colors = <%= @gamehash.colors %>;
    for (var color of colors) {
      var guideCell = document.getElementById("guidecell-" + color);
      guideCell.classList.remove("guide-highlight");
    }
  }

  function closeInstructions() {
    document.getElementById("instructions").style.display = "none";
    <%= @gamehash.instructions = false %>;
  }

</script>
